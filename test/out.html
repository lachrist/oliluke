  

  <html>
    <body><script>otiluke.catchup()</script></body>
    <head><script>
window.otiluke = (function () {

  var ready = false
  var deferred = []
  var done = 0

  function check () { if (ready && done === deferred.length) { deferred.forEach(window.eval) } }

  return {
    load: function (src, charset, async, defer) {
      var request = new XMLHttpRequest()
      request.open("GET", src, async||defer)
      if (charset) { request.setRequestHeader("Accept-Charset", charset) }
      request.send(null)
      if (async) {
        request.onreadystatechange = function () {
          if (request.readyState === 4) {
            window.eval(request.responseText)
          }
        }
      } else if (defer) {
        var id = deferred.push(null) - 1
        request.onreadystatechange = function () {
          if (request.readyState === 4) {
            deferred[id] = request.responseText
            done++
            check()
          }
        }
      } else {
        window.eval(request.responseText)
      }
    },
    catchup: function () {
      ready = true
      check()
    }
  }

} ())
</script>
    <script>window.eval("console.log(\"text1\")")</script>
    <script defer="">otiluke.load("script1.js",null,false,true)</script>
    <script>otiluke.load("script2.js",null,false,false)</script>
    <script async="">otiluke.load("script3.js",null,true,false)</script>
    <script defer="">otiluke.load("script4.js",null,false,true)</script>
    <script>window.eval("console.log(\"text2\")")</script>
    </head>
    <body>
    <button onclick="window.eval(&#34console.log('&#38&#38&#38')&#34)">Button</button>
    <script>otiluke.catchup()</script></body>
  </html>

